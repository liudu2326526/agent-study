# SmartFlow Agent Hub - MVP 版本需求文档 (v1.0)

## 1. MVP 目标 (MVP Goals)
**核心目标**：验证“对话即服务”在广告营销场景中的价值闭环。重点解决**知识快速检索**、**工具扩展能力**及**素材创意生产**三大高频痛点，确保核心用户（投放/运营/设计）能通过自然语言完成单一闭环任务。

**验证指标**：
- 知识检索准确率 > 85%
- MCP 工具调用成功率 > 90%
- 图片生成/优化满意度 > 80%
- 单次会话平均交互轮数 < 5 轮（高效解决问题）

---

## 2. 交付范围 (Scope of Delivery)

### 2.1 用户端功能 (User Features)

#### A. 统一对话界面 (Unified Chat Interface)
- **基础对话**：支持流式输出 (Streaming)，显示打字机效果。
- **多模态输入**：
  - 纯文本指令。
  - 文件上传：支持拖拽上传 PDF, Word, Excel, CSV（单文件限制 50MB）及图片（JPG/PNG）。
- **交互反馈**：
  - 状态指示器：显示“思考中”、“检索知识库中”、“正在调用工具”、“正在生成图片”等状态。
  - 引用标注：回答中必须包含来源角标（如 `[1]`），点击可展开查看引用的文档段落或网页链接。
  - 媒体展示：支持在对话框中直接预览生成的图片或处理后的图片对比。

#### B. 核心 Agent 引擎 (Core Engine)
- **意图识别 (v1.0)**：
  - 区分三类核心意图：
    1. **闲聊/通用问答** -> 直接调用大模型。
    2. **知识库问答** -> 触发 RAG 检索。
    3. **工具调用** -> 触发 MCP 协议连接的外部工具（含图片服务）。
- **会话记忆**：
  - 仅支持**当前会话**的上下文记忆（Window size: 10轮），刷新页面后重置。

#### C. 专属知识库 (Knowledge Base - MVP)
- **文档管理**：
  - 支持上传/删除文档。
  - 列表展示：文件名、上传时间、状态（索引中/已完成）。
- **解析能力**：
  - 文本提取：PDF/Word/Markdown。
  - 表格理解：Excel/CSV 基础结构识别。

#### D. 智能工具箱 (P0 Tools Only)
仅集成以下核心能力，移除内置搜索与数据分析，全面拥抱 MCP 标准：

1.  **文件处理 (File Reader)**：
    - 能力：读取用户上传的文件内容。
    - 场景：总结文档摘要、提取关键条款。
2.  **MCP 客户端 (MCP Client)**：
    - 能力：支持连接标准 Model Context Protocol (MCP) 服务器。
    - 配置：支持用户/管理员配置 MCP Server 地址（SSE/Stdio）。
    - 场景：通过接入外部 MCP Server 实现网络搜索、数据库查询、代码执行等扩展能力。

---

## 3. 关键业务流程 (Key User Flows)

### 流程一：广告合规查询 (RAG Flow)
1.  用户上传《2024广告审核规范.pdf》。
2.  用户提问：“美妆类广告可以使用‘顶级’这个词吗？”
3.  Agent 检索文档 -> 找到相关条款 -> 回答：“根据规范第3.2条，美妆类广告禁止使用绝对化用语，包括‘顶级’、‘第一’等。” -> 附带文档引用链接。

### 流程二：MCP 工具扩展 (MCP Tool Flow)
*假设已配置 "Google Search MCP Server"*
1.  用户指令：“搜索一下 A 公司最近上线的‘春节大促’活动有哪些亮点。”
2.  Agent 识别意图 -> 发现匹配的 MCP 工具 `google_search` -> 发送调用请求。
3.  MCP Server 执行搜索并返回结果 -> Agent 总结关键信息 -> 输出简报。

### 流程三：广告素材生产 (Creative Flow)
1.  用户指令：“帮我生成一张春节促销的海报背景，要有红色灯笼和金色字体。”
2.  Agent 调用 **Image Gen MCP** -> 生成 4 张候选图。
3.  用户选择其中一张 -> 指令：“把这张图放大 2 倍，并且去掉左下角的杂物。”
4.  Agent 调用 **Image Opt MCP** -> 执行放大和重绘/裁剪 -> 返回最终高清素材。

---

## 4. 非功能性约束 (Constraints)

- **响应延迟**：
  - 纯文本对话：首字延迟 < 2s。
  - 涉及工具/检索：首字延迟 < 5s（需展示“思考中”状态）。
- **并发限制**：
  - MVP 阶段支持 20 人并发使用。
- **数据安全**：
  - 上传的文件仅在当前会话或个人知识库可见。
  - 不进行持久化存储超过 7 天（MVP 临时策略）。

---

## 5. 暂不包含 (Out of Scope for MVP)
- **不支持** 语音输入/输出。
- **不支持** 复杂的 L3/L4 自主执行（如自动发邮件、自动监控报警）。
- **不支持** 第三方应用集成（Jira, Slack, GitHub）。
- **不支持** 知识库的高级版本管理和冲突检测。
- **不支持** 复杂的权限管理（MVP 仅区分普通用户和管理员）。
